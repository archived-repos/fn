/*! jstools-core 2014-11-29 */
fn.define("ajax",["promise",function(a){"use strict";function b(b,c){if(c||(c=b instanceof Object?b:{}),c.url&&(b=c.url),!b)return!1;c.method||(c.method="GET"),c.contentType||(c.contentType=/^json$/i.test(c.mode)?"application/json":"application/x-www-form-urlencoded"),/^json$/i.test(c.mode)&&isObject(c.data)&&(c.data=JSON.stringify(c.data));var d=null;try{d=new XMLHttpRequest}catch(e){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){d=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===d)throw"Browser does not support HTTP Request";return d.promise=a(function(a,e){if(d.open(c.method,b,void 0===c.async?!0:c.async),d.onreadystatechange=function(){if("complete"==d.readyState||4==d.readyState)if(d.status>=200&&d.status<300){var b=/^json$/i.test(c.mode)?JSON.parse(d.responseText):/^xml$/i.test(c.mode)?d.responseXML:d.responseText;a(b,d.status,d)}else{var b=/^json$/i.test(c.mode)?JSON.parse(d.responseText):/^xml$/i.test(c.mode)?d.responseXML:d.responseText;e(b,d.status,d)}},d.setRequestHeader("Content-Type",c.contentType),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.headers)for(var f in c.headers)d.setRequestHeader(f,c.headers[f]);d.send(c.data)}),d.promise}return b}]),fn.define("cookie",function(){"use strict";function a(b,c,d,e,f,g){return c?void a.set(b,c,d,e,f,g):a.get(b)}return a.get=function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},a.set=function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},a.remove=function(b,c,d){return a.hasKey(b)?(document.cookie=encodeURIComponent(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(d?"; domain="+d:"")+(c?"; path="+c:""),!0):!1},a.hasKey=function(a){return a?new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},a.keys=function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=a.length,c=0;b>c;c++)a[c]=decodeURIComponent(a[c]);return a},a}),fn.define("Events",function(){"use strict";function a(a,b,c){return!b instanceof Function?!1:void a.push({handler:b,context:c})}function b(a,b,c){if(a){for(var d=0,e=a.length;e>d;d++)a[d].handler.call(c,b);return e}}function c(a){a&&a.splice(0,a.length)}function d(a,b){if(a)for(var c=0,d=a.length;d>c;)a[c].handler===b?(a.splice(c,1),d--):c++}function e(e){e=e||this;var f={},g={};e.on=function(b,c,d){f[b]=f[b]||[],a(f[b],c,d)},e.once=function(b,c,d){g[b]=g[b]||[],a(g[b],c,d)},e.trigger=function(a,c,d){b(f[a],c,d);var e=b(g[a],c,d);e&&g[a].splice(0,e)},e.off=function(a,b){void 0===b?(c(f[a]),c(g[a])):(d(f[a],b),d(g[a],b))}}return e}),function(a){"undefined"==typeof window?"undefined"!=typeof module&&(module.exports=a):window.fn?fn.define("$",a):window.$||(window.$=a)}(function(){"use strict";function stopEvent(a){a&&(a.stopped=!0),a&&a.preventDefault?a.preventDefault():window.event&&window.event.returnValue&&(window.eventReturnValue=!1)}function triggerEvent(a,b,c){var d;return document.createEvent?(d=document.createEvent("HTMLEvents"),d.data=c,d.initEvent(b,!0,!0)):(d=document.createEventObject(),d.data=c),document.createEvent?a.dispatchEvent(d):a.fireEvent("on"+d.eventType,d),d}function listDOM(a){"string"==typeof a?RE_HAS_SPACES.test(a)?[].push.apply(this,document.querySelectorAll(a)):RE_ONLY_LETTERS.test(a)?[].push.apply(this,document.getElementsByTagName(a)):RE_IS_ID.test(a)?[].push.call(this,document.getElementById(a.substr(1))):RE_IS_CLASS.test(a)?[].push.apply(this,document.getElementsByClassName(a.substr(1))):[].push.apply(this,document.querySelectorAll(a)):a instanceof Array?[].push.apply(this,a):a instanceof NodeList?[].push.apply(this,a):a instanceof HTMLCollection?[].push.apply(this,a):a instanceof Element?[].push.call(this,a):a===document&&[].push.call(this,a)}Element.prototype.matchesSelector||(Element.prototype.matchesSelector=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector);var RE_HAS_SPACES=/\s/,RE_ONLY_LETTERS=/^[a-zA-Z]+$/,RE_IS_ID=/^\#.+/,RE_IS_CLASS=/^\..+/;return listDOM.prototype=new Array,listDOM.fn=function(a,b,c){if("string"==typeof a)b instanceof Function&&(Element.prototype[a]||(Element.prototype[a]=b)),c instanceof Function&&(listDOM.prototype[a]=c,NodeList.prototype[a]=c);else if(a instanceof Object&&1==arguments.length)for(var d in a)listDOM.fn(d,a[d].element,a[d].collection)},listDOM.fn({get:{element:function(){return this},collection:function(a){return this[a]}},find:{element:function(){return new listDOM(Element.prototype.querySelectorAll.apply(this,arguments))},collection:function(a){for(var b,c=new listDOM,d=0,e=this.length;e>d;d++){b=this[d].querySelectorAll(a);for(var f=0,g=b.length;g>f;f++)b.item(f).__found||(c.push(b.item(f)),b.item(f).__found=!0)}for(var d=0,e=c.length;e>d;d++)delete c[d].__found;return c}},each:{element:function(a){return a instanceof Function&&a.call(this,this),this},collection:function(a){if(a instanceof Function)for(var b=0,c=this.length;c>b;b++)a.call(this[b],this[b]);return this}},filter:{element:function(a){return Element.prototype.matchesSelector.call(this,a)?this:!1},collection:function(a){var b=[];if(a instanceof Function){for(var c,d=0,e=this.length;e>d;d++)c=this[d],a.apply(c,[c])&&b.push(c);return new listDOM(b)}if("string"==typeof a){for(var c,d=0,e=this.length;e>d;d++)c=this[d],Element.prototype.matchesSelector.call(c,a)&&b.push(c);return new listDOM(b)}return!1}},children:{element:!1,collection:function(a,b){var c=[];return document.body.children?(c=new listDOM,Array.prototype.forEach.call(this,function(a){[].push.apply(c,a.children)}),a&&(isString(a)?c=c.filter(a):isFunction(a)&&c.each(a)),c):(isString(a)?Array.prototype.forEach.call(this,function(b){for(b=b.firstElementChild||b.firstChild;b;)b&&Element.prototype.matchesSelector.call(b,a)&&c.push(b),b=b.nextElementSibling}):isFunction(a)?Array.prototype.forEach.call(this,function(d){for(d=d.firstElementChild||d.firstChild;d;)c.push(d),a.apply(d,b),d=d.nextElementSibling}):Array.prototype.forEach.call(this,function(a){for(a=a.firstElementChild||a.firstChild;a;)c.push(a),a=a.nextElementSibling}),new listDOM(c))}},data:{element:function(a,b){return isString(a)?isString(b)?(null!=this.getAttribute("data-"+a)?this.setAttribute("data-"+a,b):void 0!==this.dataset?this.dataset[a]=b:this.setAttribute("data-"+a,b),this):this.getAttribute("data-"+a)||(this.dataset?this.dataset[a]:!1):this},collection:function(a,b){if(isString(a)){if(isString(b)){for(var c=0,d=this.length;d>c;c++)this[c].data(a,b);return this}return this[0].data(a)}return this}},attr:{element:function(a,b){return isString(a)?void 0!==b?(this.setAttribute(a,b),this):this.getAttribute(a):this},collection:function(a,b){if(isString(a)){if(isString(b)){for(var c=0,d=this.length;d>c;c++)this[c].setAttribute(a,b);return this}return this[0].getAttribute(a)}return this}},addClass:{element:document.createElement("div").classList?function(a){return this.classList.add(a),this}:function(a){this.className||(this.className="");var b=new RegExp("\\b"+a+"\\b","");return b.test(this.className)||(this.className+=" "+a),this},collection:function(a){for(var b=0,c=this.length;c>b;b++)this[b].addClass(a);return this}},removeClass:{element:document.createElement("div").classList?function(a){return this.classList.remove(a),this}:function(a){if(this.className){var b=new RegExp("(\\b|\\s+)"+a+"\\b","g");this.className=this.className.replace(b,"")}return this},collection:function(a){for(var b=0,c=this.length;c>b;b++)this[b].removeClass(a);return this}},hasClass:{element:document.createElement("div").classList?function(a){return this.classList.item(a)}:function(a){return this.className?(patt=new RegExp("\\b"+a+"\\b",""),patt.test(this.className)):!1},collection:function(a){for(var b=0,c=this.length;c>b;b++)if(element.hasClass(a))return!0;return!1}},parent:{element:function(){return this==document.body?!1:this.parentElement||this.parentNode},collection:function(){for(var a,b=new listDOM,c=0,d=this.length;d>c;c++)a=this[c].parent(),a&&b.push(a);return b}},render:{element:function(html){return this.innerHTML=html,this.find("script").each(function(script){if("text/javascript"==script.type)try{eval("(function(){ 'use strict';"+script.textContent+"})();")}catch(err){console.log(err.message)}else if(/^text\/coffee(script)/.test(script.type)&&isObject(window.CoffeeScript)&&CoffeeScript.compile instanceof Function)try{eval(CoffeeScript.compile(script.textContent))}catch(err){console.log(err.message)}}),this},collection:function(a){for(var b=0,c=this.length;c>b;b++)this[b].render(a);return this}},text:{element:function(a){return void 0===a?this.textContent:(this.textContent=a,this)},collection:function(a){if(void 0===a){a="";for(var b=0,c=this.length;c>b;b++)a+=this[b].textContent;return a}for(var b=0,c=this.length;c>b;b++)this[b].textContent=a;return this}},on:{element:function(a,b){var c=this;if(isString(a))if(isFunction(b)){var d=b;if(b=function(a){d.apply(a.target,[a].concat(a.data))},c.addEventListener)c.addEventListener(a,b,!1);else{if(!c.attachEvent)throw"No es posible a√±adir evento";c.attachEvent("on"+a,b)}c.listeners||(c.listeners={}),c.listeners[a]||(c.listeners[a]=[]),c.listeners[a].push(b)}else if(b===!1&&c.listeners&&c.listeners[a])for(var e=c.listeners[a];b=e.pop();)c.removeEventListener?c.removeEventListener(a,b,!1):c.detachEvent&&c.detachEvent("on"+a,b);return this},collection:function(a,b){return Array.prototype.forEach.call(this,function(c){c.on(a,b)}),this}},off:{element:function(a){this.on(a,!1)},collection:function(a){this.on(a,!1)}},trigger:{element:function(a,b){triggerEvent(this,a,b)},collection:function(a,b){Array.prototype.forEach.call(this,function(c){triggerEvent(c,a,b)})}}}),function(a){if(/^\<\w+.*\>$/.test(a)){var b=document.createElement("div");return b.innerHTML=a,new listDOM(b.children)}return new listDOM(a)}}),fn.define("localData",["Events",function(a){"use strict";if("undefined"==typeof window||!window.localStorage)throw"localStorage not defined";var b=function(a,c,d){return void 0!==c?(b.setItem(a,c,d),this):b.getItem(a)},c={};return new a(b),b.setItem=function(a,d,e){var f={data:d},g=localStorage.getItem(a)?JSON.parse(localStorage.getItem(a))||{}:{};return angular.extend(f,e||{}),localStorage.setItem(a,JSON.stringify(f)),c[a]&&b._trigger(a,f,g),f},b.getItem=function(a){return(JSON.parse(localStorage.getItem(a))||{}).data},b.getMeta=function(a,b){return void 0===b?JSON.parse(localStorage.getItem(a))||{}:(JSON.parse(localStorage.getItem(a))||{})[b]},b.loopback=function(a,b){c[a]=void 0===b||b},b._trigger=function(a,c,d){b.trigger(a,{url:location.href,newValueFull:c,oldValueFull:d})},window.addEventListener("storage",function(a){a=a.originalEvent,/^{.*}$/.test(a.newValue)&&b._trigger(a.key,JSON.parse(a.newValue)||{},JSON.parse(a.oldValue)||{})},!1),b}]),fn.define("parse",["_",function(_){function $parse(a){var b=a.split(splitRex),c=[b.shift()];a.replace(matchRex,function(a,d,e,f,g,h){c.push(g?{cmd:"",arg:"/"}:h?{cmd:"",arg:"else"}:{cmd:e,arg:f}),c.push(b.shift())});var d=parseTokens("root",!1,c);return function(){d.render.apply(this,arguments)}}function modelScript(a,b,c,d){this.cmd=a,this.options=c||{},this.options.args=b.split(","),this.list=d||[]}function parseTokens(a,b,c){a=(a||"").trim(),b=(b||"").trim();var d={content:[]},e="content",f=[d.content],g=function(a){d[a]=[],e=a,f.push(d[a])};for(token=c.shift();void 0!==token;){if(_.isString(token))d[e].push(token);else if(token instanceof Object)if(token.cmd)switch(token.cmd){case"i18n":d[e].push(new modelScript(token.cmd,token.arg.replace(/\/$/,"")));break;case"case":case"when":g(token.arg);break;default:d[e].push("/"==token.arg.substr(-1)?new modelScript(token.cmd,token.arg.replace(/\/$/,"")):parseTokens(token.cmd,token.arg,c))}else switch(token.arg){case"else":case"otherwise":g("otherwise");break;case"/":return new modelScript(a,b,d,f);default:d[e].push(new modelScript("var",token.arg))}token=c.shift()}return"root"!=a&&console.log("something wrong in script"),new modelScript(a,b,d,f)}var cmd={},splitRex=/\$[\w\?]*{[^\}]+}|{\$}|{\:}/,matchRex=/(\$([\w\?]*){([^\}]+)})|({\$})|({\:})/g,emptyModel=function(){this._parent=this};return $parse.cmd=function(a,b){_.isString(a)&&_.isFunction(b)&&(cmd[a]=b)},$parse._run=function(a,b){var c="";return a.forEach(function(a){_.isString(a)?c+=a:_.isObject(a,"modelscript")?c+=a.render(b):_.isArray(a)&&(c+=$parse._run(a,b))}),c},$parse.modelQuery=function(a,b){b=b.trim();for(var c,d,e=b.split("/");c=e.shift();)"."!=c&&(".."==c?a=a._parent||{}:(d=a,a=_.key(a,c),a._parent=d));return a||""},$parse.modelValue=function(model,arg){var value;if(/^[\w\_\.]+$/.test(arg))value=$parse.modelQuery(model,arg);else{var eval_vars="";_.keys(model).forEach(function(a){eval_vars+=","+a+" = model."+a});try{eval("value = (function(){ var aux"+eval_vars+"; return ("+arg+"); })();")}catch(err){console.log("ERROR: "+err.message+" in "),console.log("value = (function(){ var aux"+eval_vars+"; return ("+arg+"); })();"),console.log(model)}}return value},cmd.root=function(){return this.content},cmd.var=function(a){return a instanceof Object?"":a||""},cmd.if=function(a){return a?this.content:this.otherwise},cmd["?"]=cmd.if,modelScript.prototype.render=function(a){var b;if(!(cmd[this.cmd]instanceof Function))return"[command "+this.cmd+" not found]";var c=[];return this.options.model=a,this.options.args.forEach(function(b){c.push(b?$parse.modelValue(a,b):"")}),b=cmd[this.cmd].apply(this.options,c),_.isArray(b)?$parse._run(b,a):_.isString(b)?b:""+b},$parse.cmd("each",function(a){var b="";return a&&_.each(a,function(a){b+=$parse._run(this.content,a)}),b}),$parse.cmd("for",function(){function a(a,e){d=$parse.modelQuery(b.model,a),_.isArray(d)?d.forEach(function(a){var d={_parent:b.model};e?d[e]=a:d=a,c+=$parse._run(b.content,d)}):d instanceof Object&&_.keys(d).forEach(function(){var a={_parent:b.model};e?a[e]=item:a=item,c+=$parse._run(b.content,a)})}var b=this,c="",d=!1;if(/^\s*\S+\s+in\s+\S+\s*$/.test(this.args[0])){var e=this.args[0].match(/^\s*(\S+)\s+in\s+(\S+)\s*$/);a(e[2],e[1])}return c}),$parse.cmd("with",function(){return $parse._run(this.content,$parse.modelQuery(this.model,this.args[0]))}),$parse}]),fn.define("promise",["_",function(){var a;if(!window.Promise)throw"Promise not implemented, fallback needed";return a=function(a){return new Promise(a)},a.when=function(a){return new Promise(function(b,c){a?"function"==typeof a.then?a.then(b,c):setTimeout(function(){b(a)},0):setTimeout(function(){c(a)},0)})},a.defer=function(){var a,b=new Promise(function(b,c){a={resolve:b,reject:c}});return a.promise=b,a},a}]),fn.define("Scope",function(){function a(a){for(var b in a)this[b]=a[b]}function b(b){function c(a){for(var b in a)this[b]=a[b]}c.prototype=this;for(var d in a.prototype)c.prototype[d]=a.prototype[d];return new c(b)}return a.prototype.$new=b,a});